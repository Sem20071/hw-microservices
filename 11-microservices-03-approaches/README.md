# Домашнее задание к занятию «Микросервисы: подходы»
## Задача 1: Обеспечить разработку
Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.
Обоснуйте свой выбор.

## Ответ:
#### Предложенное решение GitLab Ultimate + GitLab Runner.
Компоненты решения
1. Система контроля версий и платформа CI/CD
GitLab Ultimate (SaaS/Cloud)
- Хранение кода: Git-репозитории для каждого микросервиса;
- CI/CD: Встроенная система непрерывной интеграции и поставки;
- Container Registry: Встроенный реестр Docker-образов;
- Security: Secret detection, dependency scanning, SAST.

2. Система сборки
GitLab Runner (self-hosted)
- Запуск на собственных серверах (Kubernetes cluster или VM);
- Автоскейлинг агентов сборки;
- Поддержка Docker executor для изоляции сборок.

Данное решение соответствует всем заявленным требованиям.
|Требование| Реализация в GitLab |
|-----|-----|
| Облачная система | GitLab SaaS (gitlab.com) или self-managed в облаке |
| Git репозиторий на сервис | Отдельный проект/repo для каждого микросервиса |
| Сборка по событию из Git | Webhooks, push/merge triggers в .gitlab-ci.yml |
| Сборка по кнопке с параметрами | Manual jobs with variables in CI/CD |
| Настройки для каждой сборки | CI/CD variables (project/group/instance level) |
| Шаблоны конфигураций | .gitlab-ci.yml templates, includes, extends |
| Безопасное хранение секретов | GitLab CI/CD Variables (masked/protected), HashiCorp Vault integration |
| Несколько конфигураций из одного репозитория | Multiple jobs in pipeline, matrix builds |
| Кастомные шаги сборки | Custom scripts in .gitlab-ci.yml |
| Собственные Docker-образы | Custom images in GitLab Container Registry |
| Собственные агенты сборки | Self-hosted GitLab Runners |
| Параллельные сборки | Parallel jobs in stages |
| Параллельные тесты | Parallel matrix testing, Test coverage visualization |

### Преимущества выбора GitLab
#### Технические преимущества:
1. Единая платформа - код, CI/CD, registry в одном месте;
2. Мультитенантность - изоляция между командами микросервисов;
3. Масштабируемость - автоскейлинг runners под нагрузку;
4. Безопасность - встроенные security scanning tools.

#### Экономические преимущества:
1. Снижение TCO - единая платформа вместо набора инструментов;
2. Экономия на лицензиях - один поставщик вместо нескольких;
3. Снижение operational overhead - меньше точек отказа.

## Задача 2: Логи
Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.
Обоснуйте свой выбор.

## Ответ:
Под данные требования не плохо подайдет ELK stack c агентом filebeat:
#### Обзор компонентов:
1. Filebeat - Агент для сбора логов:
- Легковесный (~10MB memory, минимальное CPU);
- Сбор из stdout через Docker/CRI лог-драйверы;
- Встроенная буферизация для гарантированной доставки;
- Поддержка backpressure при перегрузке приемника.

2. Logstash - Обработка и трансформация:
- Парсинг и обогащение логов;
- Фильтрация и модификация данных;
- Балансировка нагрузки между экземплярами;
- Поддержка плагинов для различных форматов.

3. Elasticsearch - Хранение и поиск:
- Распределенное хранилище с репликацией;
- Инвертированный индекс для быстрого поиска;
- REST API для запросов;
- RBAC управление доступом.

4. Kibana - Визуализация и UI:
- Web-интерфейс для поиска и анализа;
- KQL (Kibana Query Language) для сложных запросов;
- Saved Searches с шарингом ссылок;
- Dashboards для мониторинга.

#### Соответствие требованиям:
|Требование	| Реализация в ELK Stack |
|------------|-----------------------|
|Сбор логов со всех хостов	| Filebeat DaemonSet на каждом узле |
| Минимальные требования к приложениям	| Сбор из stdout, JSON формат |
| Гарантированная доставка |	Filebeat буферизация + retry механизмы |
| Поиск и фильтрация	| Elasticsearch + Kibana KQL |
| UI для разработчиков	| Kibana с настройкой прав доступа |
| Ссылки на сохраненный поиск	| Saved Objects и direct links |

## Задача 3: Мониторинг
Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.
Обоснуйте свой выбор.

## Ответ:
Под данные требованияподайдет решение Prometheus + Grafana + Сборщики метрик (Node Exporter, Cadvisor)
#### Обзор компонентов
1. Prometheus - Сбор и хранение метрик
- Pull-модель сбора данных
- Multi-dimensional data model с labels
- PromQL - мощный язык запросов
- Временные ряды с эффективным сжатием

2. Grafana - Визуализация и дашборды
- Богатые визуализации (графики, таблицы, heatmaps)
- Dashboard as code - версионирование конфигураций
- Templating для динамических дашбордов
- Alerting с интеграцией в различные системы

3. Exporters - Сбор метрик
- Node Exporter - метрики хостов
- cAdvisor - метрики контейнеров

#### Соответствие требованиям:
|Требование	| Реализация в Prometheus + Grafana |
|------------|-----------------------|
| Сбор метрик со всех хостов | Node Exporter |
| Метрики ресурсов хостов | Node Exporter (CPU, RAM, Disk, Network) |
| Метрики ресурсов сервисов | cAdvisor + контейнерные метрики |
| Специфичные метрики сервисов | Custom exporters + application instrumentation |
| Запросы и агрегация | PromQL в Grafana/Prometheus UI |
| Настраиваемые панели | Grafana dashboards с большим количеством шаблонов |
